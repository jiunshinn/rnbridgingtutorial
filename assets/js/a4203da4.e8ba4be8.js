"use strict";(self.webpackChunkbridging_tutorial_website=self.webpackChunkbridging_tutorial_website||[]).push([[2918],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>v});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),u=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},m=function(e){var t=u(e.components);return a.createElement(s.Provider,{value:t},e.children)},d="mdxType",c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},p=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),d=u(n),p=r,v=d["".concat(s,".").concat(p)]||d[p]||c[p]||o;return n?a.createElement(v,i(i({ref:t},m),{},{components:n})):a.createElement(v,i({ref:t},m))}));function v(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[d]="string"==typeof e?e:r,i[1]=l;for(var u=2;u<o;u++)i[u]=n[u];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}p.displayName="MDXCreateElement"},5162:(e,t,n)=>{n.d(t,{Z:()=>i});var a=n(7294),r=n(6010);const o={tabItem:"tabItem_Ymn6"};function i(e){let{children:t,hidden:n,className:i}=e;return a.createElement("div",{role:"tabpanel",className:(0,r.Z)(o.tabItem,i),hidden:n},t)}},4866:(e,t,n)=>{n.d(t,{Z:()=>N});var a=n(7462),r=n(7294),o=n(6010),i=n(2466),l=n(6550),s=n(1980),u=n(7392),m=n(12);function d(e){return function(e){return r.Children.map(e,(e=>{if((0,r.isValidElement)(e)&&"value"in e.props)return e;throw new Error(`Docusaurus error: Bad <Tabs> child <${"string"==typeof e.type?e.type:e.type.name}>: all children of the <Tabs> component should be <TabItem>, and every <TabItem> should have a unique "value" prop.`)}))}(e).map((e=>{let{props:{value:t,label:n,attributes:a,default:r}}=e;return{value:t,label:n,attributes:a,default:r}}))}function c(e){const{values:t,children:n}=e;return(0,r.useMemo)((()=>{const e=t??d(n);return function(e){const t=(0,u.l)(e,((e,t)=>e.value===t.value));if(t.length>0)throw new Error(`Docusaurus error: Duplicate values "${t.map((e=>e.value)).join(", ")}" found in <Tabs>. Every value needs to be unique.`)}(e),e}),[t,n])}function p(e){let{value:t,tabValues:n}=e;return n.some((e=>e.value===t))}function v(e){let{queryString:t=!1,groupId:n}=e;const a=(0,l.k6)(),o=function(e){let{queryString:t=!1,groupId:n}=e;if("string"==typeof t)return t;if(!1===t)return null;if(!0===t&&!n)throw new Error('Docusaurus error: The <Tabs> component groupId prop is required if queryString=true, because this value is used as the search param name. You can also provide an explicit value such as queryString="my-search-param".');return n??null}({queryString:t,groupId:n});return[(0,s._X)(o),(0,r.useCallback)((e=>{if(!o)return;const t=new URLSearchParams(a.location.search);t.set(o,e),a.replace({...a.location,search:t.toString()})}),[o,a])]}function b(e){const{defaultValue:t,queryString:n=!1,groupId:a}=e,o=c(e),[i,l]=(0,r.useState)((()=>function(e){let{defaultValue:t,tabValues:n}=e;if(0===n.length)throw new Error("Docusaurus error: the <Tabs> component requires at least one <TabItem> children component");if(t){if(!p({value:t,tabValues:n}))throw new Error(`Docusaurus error: The <Tabs> has a defaultValue "${t}" but none of its children has the corresponding value. Available values are: ${n.map((e=>e.value)).join(", ")}. If you intend to show no default tab, use defaultValue={null} instead.`);return t}const a=n.find((e=>e.default))??n[0];if(!a)throw new Error("Unexpected error: 0 tabValues");return a.value}({defaultValue:t,tabValues:o}))),[s,u]=v({queryString:n,groupId:a}),[d,b]=function(e){let{groupId:t}=e;const n=function(e){return e?`docusaurus.tab.${e}`:null}(t),[a,o]=(0,m.Nk)(n);return[a,(0,r.useCallback)((e=>{n&&o.set(e)}),[n,o])]}({groupId:a}),f=(()=>{const e=s??d;return p({value:e,tabValues:o})?e:null})();(0,r.useLayoutEffect)((()=>{f&&l(f)}),[f]);return{selectedValue:i,selectValue:(0,r.useCallback)((e=>{if(!p({value:e,tabValues:o}))throw new Error(`Can't select invalid tab value=${e}`);l(e),u(e),b(e)}),[u,b,o]),tabValues:o}}var f=n(2389);const g={tabList:"tabList__CuJ",tabItem:"tabItem_LNqP"};function h(e){let{className:t,block:n,selectedValue:l,selectValue:s,tabValues:u}=e;const m=[],{blockElementScrollPositionUntilNextRender:d}=(0,i.o5)(),c=e=>{const t=e.currentTarget,n=m.indexOf(t),a=u[n].value;a!==l&&(d(t),s(a))},p=e=>{let t=null;switch(e.key){case"Enter":c(e);break;case"ArrowRight":{const n=m.indexOf(e.currentTarget)+1;t=m[n]??m[0];break}case"ArrowLeft":{const n=m.indexOf(e.currentTarget)-1;t=m[n]??m[m.length-1];break}}t?.focus()};return r.createElement("ul",{role:"tablist","aria-orientation":"horizontal",className:(0,o.Z)("tabs",{"tabs--block":n},t)},u.map((e=>{let{value:t,label:n,attributes:i}=e;return r.createElement("li",(0,a.Z)({role:"tab",tabIndex:l===t?0:-1,"aria-selected":l===t,key:t,ref:e=>m.push(e),onKeyDown:p,onClick:c},i,{className:(0,o.Z)("tabs__item",g.tabItem,i?.className,{"tabs__item--active":l===t})}),n??t)})))}function y(e){let{lazy:t,children:n,selectedValue:a}=e;if(n=Array.isArray(n)?n:[n],t){const e=n.find((e=>e.props.value===a));return e?(0,r.cloneElement)(e,{className:"margin-top--md"}):null}return r.createElement("div",{className:"margin-top--md"},n.map(((e,t)=>(0,r.cloneElement)(e,{key:t,hidden:e.props.value!==a}))))}function k(e){const t=b(e);return r.createElement("div",{className:(0,o.Z)("tabs-container",g.tabList)},r.createElement(h,(0,a.Z)({},e,t)),r.createElement(y,(0,a.Z)({},e,t)))}function N(e){const t=(0,f.Z)();return r.createElement(k,(0,a.Z)({key:String(t)},e))}},5518:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>s,default:()=>v,frontMatter:()=>l,metadata:()=>u,toc:()=>d});var a=n(7462),r=(n(7294),n(3905)),o=n(4866),i=n(5162);const l={sidebar_label:"Module events",sidebar_position:5,title:"Module events"},s=void 0,u={unversionedId:"module-reference/module-events",id:"module-reference/module-events",title:"Module events",description:"Event emitter declaration",source:"@site/docs/module-reference/module-events.mdx",sourceDirName:"module-reference",slug:"/module-reference/module-events",permalink:"/rnbridgingtutorial/docs/module-reference/module-events",draft:!1,editUrl:"https://github.com/mateusz1913/rnbridgingtutorial/tree/main/docs/docs/module-reference/module-events.mdx",tags:[],version:"current",sidebarPosition:5,frontMatter:{sidebar_label:"Module events",sidebar_position:5,title:"Module events"},sidebar:"tutorialSidebar",previous:{title:"Method arguments (old arch)",permalink:"/rnbridgingtutorial/docs/module-reference/module-args-types-old"},next:{title:"Module events (old arch)",permalink:"/rnbridgingtutorial/docs/module-reference/module-events-old"}},m={},d=[{value:"Event emitter declaration",id:"event-emitter-declaration",level:3},{value:"Event emitter implementation in native code",id:"event-emitter-implementation-in-native-code",level:3},{value:"Event emitter implementation in JS code",id:"event-emitter-implementation-in-js-code",level:3}],c={toc:d},p="wrapper";function v(e){let{components:t,...n}=e;return(0,r.kt)(p,(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h3",{id:"event-emitter-declaration"},"Event emitter declaration"),(0,r.kt)("p",null,"To make it possible for the module to emit events, JS spec needs to declare 2 methods:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/NativeMyAwesomeModule.ts"',title:'"src/NativeMyAwesomeModule.ts"'},"import type { TurboModule } from 'react-native';\nimport { TurboModuleRegistry } from 'react-native';\n\n// ...\n\nexport interface Spec extends TurboModule {\n  addListener(eventName: string): void\n  removeListeners(count: number): void\n}\n\nexport default TurboModuleRegistry.getEnforcing<Spec>('MyAwesomeModule');\n")),(0,r.kt)("h3",{id:"event-emitter-implementation-in-native-code"},"Event emitter implementation in native code"),(0,r.kt)(o.Z,{groupId:"native_side",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"iOS",label:"iOS",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-objc",metastring:'title="ios/NativeMyAwesomeModule.h"',title:'"ios/NativeMyAwesomeModule.h"'},"#import <React/RCTBridgeModule.h>\n#import <React/RCTEventEmitter.h>\n\n@interface NativeMyAwesomeModule : RCTEventEmitter<RCTBridgeModule>\n\n@end\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-objc",metastring:'title="ios/NativeMyAwesomeModule.mm"',title:'"ios/NativeMyAwesomeModule.mm"'},'#import "NativeMyAwesomeModule.h"\n\n@implementation NativeMyAwesomeModule {\n    BOOL hasListeners;\n}\n\nRCT_EXPORT_MODULE(NativeMyAwesomeModule)\n\n- (NSArray<NSString *> *)supportedEvents\n{\n    return @[@"decentEvent", @"notGreatEvent"];\n}\n\n- (void)startObserving\n{\n    hasListeners = YES;\n}\n\n- (void)stopObserving\n{\n    hasListeners = NO;\n}\n\n- (void)onSomeNativeEvent:(NSString *)someNativeValue\n{\n    if (hasListeners) {\n        [self sendEventWithName:@"decentEvent" body:@{ @"value": someNativeValue }];\n    }\n}\n\n@end\n')),(0,r.kt)("p",null,"To enhance iOS native module with event emitting feature, it has to extend ",(0,r.kt)("inlineCode",{parentName:"p"},"RCTEventEmitter")," abstract class."),(0,r.kt)("p",null,"Then in the implementation part, module has to override ",(0,r.kt)("inlineCode",{parentName:"p"},"supportedEvents")," getter which declares names for events emitted by this module.\nIt has to also override ",(0,r.kt)("inlineCode",{parentName:"p"},"startObserving")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"stopObserving")," methods, which are called when first and last listeners are added/removed."),(0,r.kt)("p",null,"To emit event, the module should call ",(0,r.kt)("inlineCode",{parentName:"p"},"sendEventWithName:body:")," method, which is inherited from ",(0,r.kt)("inlineCode",{parentName:"p"},"RCTEventEmitter")," class.\nIt takes event name and an object payload (NSDictionary type), which will be send to JS listener.")),(0,r.kt)(i.Z,{value:"Android",label:"Android",mdxType:"TabItem"},(0,r.kt)(o.Z,{groupId:"android_lang",mdxType:"Tabs"},(0,r.kt)(i.Z,{value:"kotlin",label:"Kotlin",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="android/src/main/newarch/com/myawesomeapp/NativeMyAwesomeModule.kt"',title:'"android/src/main/newarch/com/myawesomeapp/NativeMyAwesomeModule.kt"'},"override fun addListener(eventName: String?) = Unit\n\noverride fun removeListeners(count: Double) = Unit\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="android/src/main/java/com/myawesomeapp/NativeMyAwesomeModuleImpl.kt"',title:'"android/src/main/java/com/myawesomeapp/NativeMyAwesomeModuleImpl.kt"'},'import com.facebook.react.bridge.Arguments\nimport com.facebook.react.bridge.ReactContext\nimport com.facebook.react.modules.core.DeviceEventManagerModule\n\n// ...\n\nfun onSomeNativeEvent(someNativeValue: String) {\n    val reactContext: ReactContext = getReactContextFromTheModule()\n    reactContext\n        .getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter::class.java)\n        .emit("decentEvent", Arguments.createMap().apply {\n            putString("value", someNativeValue)\n        })\n}\n'))),(0,r.kt)(i.Z,{value:"java",label:"Java",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-java",metastring:'title="android/src/main/newarch/com/myawesomeapp/NativeMyAwesomeModule.java"',title:'"android/src/main/newarch/com/myawesomeapp/NativeMyAwesomeModule.java"'},"@Override\npublic void addListener(String eventName) {}\n\n@Override\npublic void removeListeners(double count) {}\n")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-kotlin",metastring:'title="android/src/main/java/com/myawesomeapp/NativeMyAwesomeModuleImpl.java"',title:'"android/src/main/java/com/myawesomeapp/NativeMyAwesomeModuleImpl.java"'},'import com.facebook.react.bridge.Arguments;\nimport com.facebook.react.bridge.ReactContext;\nimport com.facebook.react.bridge.WritableMap;\nimport com.facebook.react.modules.core.DeviceEventManagerModule;\n\n// ...\n\nprivate void onSomeNativeEvent(String someNativeValue) {\n    ReactContext reactContext = getReactContextFromTheModule();\n    WritableMap payload = Arguments.createMap();\n    payload.putString("value", someNativeValue);\n    reactContext\n        .getJSModule(DeviceEventManagerModule.RCTDeviceEventEmitter.class)\n        .emit("decentEvent", payload);\n}\n')))),(0,r.kt)("p",null,"To enhance Android native module with event emitting feature, it has to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"declare ",(0,r.kt)("inlineCode",{parentName:"li"},"addListener")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"removeListeners")," methods"),(0,r.kt)("li",{parentName:"ul"},"use ",(0,r.kt)("inlineCode",{parentName:"li"},"RCTDeviceEventEmitter")," class for events emitting")),(0,r.kt)("p",null,"To emit event, the module should call ",(0,r.kt)("inlineCode",{parentName:"p"},"emit")," method on ",(0,r.kt)("inlineCode",{parentName:"p"},"RCTDeviceEventEmitter")," instance.\nThe first argument is the event name and the second one is payload object (",(0,r.kt)("inlineCode",{parentName:"p"},"WritableMap")," type) which will be sent to JS listener.\nIt can be constructed with ",(0,r.kt)("inlineCode",{parentName:"p"},"Arguments.createMap")," utility function."))),(0,r.kt)("h3",{id:"event-emitter-implementation-in-js-code"},"Event emitter implementation in JS code"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="src/MyAwesomeHook.ts"',title:'"src/MyAwesomeHook.ts"'},"import { NativeEventEmitter, Platform } from 'react-native';\n\nimport { MyAwesomeModule } from 'my-awesome-module';\n\nconst moduleEventEmitter = new NativeEventEmitter(Platform.OS === 'ios' ? MyAwesomeModule : undefined);\n\n// ...\n\nuseEffect(() => {\n  const subscription = moduleEventEmitter.addListener('decentEvent', ({ value }: { value: string }) => {\n    console.log({ someNativeValue: value });\n  });\n\n  return () => {\n    subscription.remove();\n  };\n}, []);\n")),(0,r.kt)("p",null,"To start listening to events emitted from native side, you have to:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"create ",(0,r.kt)("inlineCode",{parentName:"li"},"NativeEventEmitter")," instance"),(0,r.kt)("li",{parentName:"ul"},"invoke ",(0,r.kt)("inlineCode",{parentName:"li"},"addListener")," method on that instance, providing the event name and the listener function")),(0,r.kt)("p",null,"When the event is emitted, all listeners for that specific event will be called with the payload value."),(0,r.kt)("p",null,"When the listener is not needed, it should be removed - as a cleanup, it's recommended to invoke ",(0,r.kt)("inlineCode",{parentName:"p"},"remove")," method on the object returned from ",(0,r.kt)("inlineCode",{parentName:"p"},"addListener")," method call.\nIt will unregister provided listener from emitted native events."))}v.isMDXComponent=!0}}]);